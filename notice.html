<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #111;
      line-height: 1.6;
      font-size: 13px;
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding-bottom: 40px;
    }

    .top-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #111;
      color: #fff;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .top-bar h1 {
      font-size: 15px;
      font-weight: 600;
    }
    .role-select {
      font-size: 13px;
    }
    .role-select select {
      padding: 4px 8px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
    }

    .tab-nav {
      display: flex;
      gap: 8px;
      padding: 10px 14px 0;
      background: #f5f5f5;
      position: sticky;
      top: 46px;
      z-index: 9;
    }
    .tab-btn {
      flex: 1;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }
    .tab-btn.active {
      background: #111;
      color: #fff;
      border-color: #111;
      font-weight: 600;
    }

    .tab-panel {
      display: none;
      padding: 12px 14px 0;
    }
    .tab-panel.active {
      display: block;
    }

    .section-head {
      margin-bottom: 8px;
    }
    .section-head h2 {
      font-size: 14px;
      font-weight: 600;
    }
    .section-head p {
      font-size: 12px;
      color: #555;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      padding: 10px 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
      margin-bottom: 10px;
    }

    .form-group {
      margin-bottom: 8px;
    }
    .form-group label {
      display: block;
      font-size: 12px;
      margin-bottom: 2px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
      resize: vertical;
    }
    textarea {
      min-height: 60px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }
    .btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-primary {
      background: #111;
      color: #fff;
    }
    .btn-ghost {
      background: #eee;
      color: #333;
    }

    .item-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .item-body {
      font-size: 13px;
      white-space: pre-wrap;
      margin-bottom: 4px;
    }
    .item-meta {
      font-size: 11px;
      color: #777;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .badge {
      display: inline-block;
      padding: 1px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: #eee;
      color: #555;
    }
    .badge-status {
      background: #fbe5e5;
      color: #b00;
    }

    /* å½¹å‰²ã§è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ */
    .owner-only { display: none; }
    .staff-only { display: none; }

    body.role-owner .owner-only { display: block; }
    body.role-staff .staff-only { display: block; }

    .empty-text {
      font-size: 12px;
      color: #777;
      padding: 4px 2px 2px;
    }

    .tab-note {
      font-size: 12px;
      color: #555;
      line-height: 1.5;
    }


    
  </style>
</head>
<body class="role-staff">
  <div class="app">
    <div class="top-bar">
      <h1>å—éƒ¨ç”ºãƒ­ãƒ¼ã‚½ãƒ³ ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼</h1>
      <div class="role-select">
        ã‚ãªãŸã®ç«‹å ´ï¼š
        <select id="roleSelect">
          <option value="staff">ã‚¹ã‚¿ãƒƒãƒ•</option>
          <option value="owner">ã‚ªãƒ¼ãƒŠãƒ¼</option>
        </select>
      </div>
    </div>

    <!-- ã‚¿ãƒ– -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="ownerNews">â‘  çµŒå–¶è€… â†’ å…¨å“¡</button>
      <button class="tab-btn" data-tab="reports">â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…</button>
      <button class="tab-btn" data-tab="board">â‘¢ å…¨å“¡æ²ç¤ºæ¿</button>
    </div>

        <!-- â‘  çµŒå–¶è€… â†’ å…¨å“¡ -->
    <section class="tab-panel active" id="tab-ownerNews">
      <div class="section-head">
        <h2>â‘  çµŒå–¶è€… â†’ å…¨å“¡ã¸ã®ãŠçŸ¥ã‚‰ã›</h2>
        <p>ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰å…¨ã‚¹ã‚¿ãƒƒãƒ•ã«ä¼ãˆãŸã„ã“ã¨ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>
      </div>

      <!-- â˜… ã“ã“ã¯ã€Œèª­ã‚€ã ã‘ã€ã‚¨ãƒªã‚¢ -->
      <div class="card">
        <p class="tab-note">
          â€»ã“ã“ã¯çµŒå–¶è€…ã‹ã‚‰ã®é€£çµ¡å°‚ç”¨ã§ã™ã€‚<br>
          æŠ•ç¨¿ãƒ»ç·¨é›†ã¯ <strong>ç®¡ç†ç”»é¢ï¼ˆowner.html ã®ã€ŒãŠçŸ¥ã‚‰ã›ç®¡ç†ã€ï¼‰</strong> ã‹ã‚‰ã®ã¿è¡Œãˆã¾ã™ã€‚
        </p>
      </div>

      <!-- ä¸€è¦§ï¼ˆå…¨å“¡è¦‹ã‚Œã‚‹ï¼‰ -->
      <div id="ownerNewsList"></div>
      <div id="ownerNewsEmpty" class="empty-text">ã¾ã ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    </section>


    <!-- â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€… -->
    <section class="tab-panel" id="tab-reports">
      <div class="section-head">
        <h2>â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…ï¼ˆéå…¬é–‹ã®å ±å‘Šç®±ï¼‰</h2>
        <p>ã“ã“ã‹ã‚‰é€ã£ãŸå†…å®¹ã¯ã‚ªãƒ¼ãƒŠãƒ¼ã ã‘ãŒè¦‹ã‚Œã¾ã™ã€‚ä»–ã®ã‚¹ã‚¿ãƒƒãƒ•ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
      </div>

      <!-- ã‚¹ã‚¿ãƒƒãƒ•ç”¨ï¼šå ±å‘Šãƒ•ã‚©ãƒ¼ãƒ  -->
      <div class="card staff-only">
        <form id="reportForm">
          <div class="form-group">
            <label for="reportCategory">ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="reportCategory">
              <option value="è¨­å‚™">è¨­å‚™</option>
              <option value="ãŠå®¢æ§˜">ãŠå®¢æ§˜</option>
              <option value="ã‚·ãƒ•ãƒˆ">ã‚·ãƒ•ãƒˆ</option>
              <option value="æ¥­å‹™">æ¥­å‹™</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label for="reportMessage">å†…å®¹</label>
            <textarea id="reportMessage" placeholder="ä¾‹ï¼šå†·å‡åº«ã®æ¸©åº¦ãŒé«˜ã‚ã§ã™ / ç™ºæ³¨ãƒŸã‚¹ã—ã¦ã—ã¾ã„ã¾ã—ãŸ ãªã©"></textarea>
          </div>
          <div class="form-group">
            <label for="reportName">åå‰ã¾ãŸã¯ç«¯æœ«å</label>
            <input id="reportName" type="text" placeholder="ä¾‹ï¼šãŸãªã‹ / ãƒ¬ã‚¸æ¨ªã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ ãªã©" />
          </div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">å ±å‘Šã‚’é€ä¿¡ã™ã‚‹</button>
          </div>
        </form>
      </div>

      <!-- ã‚ªãƒ¼ãƒŠãƒ¼ç”¨ï¼šå ±å‘Šä¸€è¦§ -->
      <div class="owner-only">
        <div id="reportsList"></div>
        <div id="reportsEmpty" class="empty-text">ã¾ã å ±å‘Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
      </div>
    </section>

    <!-- â‘¢ å…¨å“¡æ²ç¤ºæ¿ -->
    <section class="tab-panel" id="tab-board">
      <div class="section-head">
        <h2>â‘¢ å…¨å“¡æ²ç¤ºæ¿</h2>
        <p>ã¿ã‚“ãªã§å…±æœ‰ã—ãŸã„ã“ã¨ã‚’æ°—è»½ã«æ›¸ã‘ã‚‹æ²ç¤ºæ¿ã§ã™ã€‚ï¼ˆæ¥­å‹™ã«é–¢ä¿‚ã‚ã‚‹å†…å®¹ã§ï¼‰</p>
      </div>

      <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå…¨å“¡OKï¼‰ -->
      <div class="card">
        <form id="boardForm">
          <div class="form-group">
            <label for="boardMessage">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
            <textarea id="boardMessage" placeholder="ä¾‹ï¼šå†·å‡åº«ã®éœœãŒå¤šã„ã®ã§ã€æ¬¡ã®äººå°‘ã—æ™‚é–“ã‚ã‚Œã°ãŠé¡˜ã„ã—ã¾ã™ ãªã©"></textarea>
          </div>
          <div class="form-group">
            <label for="boardAuthor">åå‰ã¾ãŸã¯ç«¯æœ«å</label>
            <input id="boardAuthor" type="text" placeholder="ä¾‹ï¼šãªã‹ã«ã— / æ·±å¤œã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ ãªã©" />
          </div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">æ²ç¤ºæ¿ã«æŠ•ç¨¿ã™ã‚‹</button>
          </div>
        </form>
      </div>

      <!-- æ²ç¤ºæ¿ä¸€è¦§ -->
      <div id="boardList"></div>
      <div id="boardEmpty" class="empty-text">ã¾ã æ²ç¤ºæ¿ã®æŠ•ç¨¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    </section>
  </div>

  <!-- Firebase v8ï¼ˆä»Šã®ã‚µã‚¤ãƒˆã¨åŒã˜ç³»åˆ—ï¼‰ -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // â˜… ã“ã“ã‚’è‡ªåˆ†ã® firebaseConfig ã«å·®ã—æ›¿ãˆ
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();


    // â˜… ã‚µã‚¤ãƒ‰ãƒãƒ¼å…¨ä½“ã‚’ã¨ã£ã¦ãã‚‹
const sidebarNav = document.querySelector(".sidebar-nav");
// â˜… ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‡¦ç†
sidebarNav.addEventListener("click", (e) => {
  const btn = e.target.closest("button[data-view]");
  if (!btn) return;

  const view = btn.dataset.view;

  // â˜… è¿½åŠ ï¼šãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼ã ã‘ã¯åˆ¥ã‚¿ãƒ–ã§ notice.html ã‚’é–‹ã
  if (view === "notice-center") {
    window.open("notice.html", "_blank"); // â† åˆ¥ã‚¿ãƒ–ã§ notice.html ã‚’é–‹ã
    return; // ã“ã“ã§çµ‚äº†ï¼ˆswitchView ã¯å‘¼ã°ãªã„ï¼‰
  }

  // ğŸ”½ ã“ã“ã‹ã‚‰ä¸‹ã¯ã€Œä»Šã¾ã§ owner.html ã«æ›¸ã„ã¦ã‚ã£ãŸå‡¦ç†ã€ã¨åŒã˜ã“ã¨ã‚’å‘¼ã¶
  switchView(view);
});


    // ===== å½¹å‰²åˆ‡ã‚Šæ›¿ãˆ =====
    const roleSelect = document.getElementById("roleSelect");
    function updateRole(role) {
      document.body.classList.remove("role-owner", "role-staff");
      document.body.classList.add(role === "owner" ? "role-owner" : "role-staff");
    }
    roleSelect.addEventListener("change", (e) => {
      updateRole(e.target.value);
    });
    updateRole(roleSelect.value);

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;

        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        document.querySelectorAll(".tab-panel").forEach(panel => {
          panel.classList.toggle("active", panel.id === `tab-${tab}`);
        });
      });
    });

    // ===== æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ =====
    function formatDate(ts) {
      if (!ts) return "";
      const d = ts.toDate();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mi = String(d.getMinutes()).padStart(2, "0");
      return `${yyyy}/${mm}/${dd} ${hh}:${mi}`;
    }

    // ============================
    // â‘  ownerNewsï¼ˆçµŒå–¶è€… â†’ å…¨å“¡ï¼‰â€»ã“ã“ã¯èª­ã¿å–ã‚Šå°‚ç”¨
    // ============================
    const ownerNewsList = document.getElementById("ownerNewsList");
    const ownerNewsEmpty = document.getElementById("ownerNewsEmpty");

    // owner.html ã‹ã‚‰æŠ•ç¨¿ã•ã‚ŒãŸ ownerNews ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª­ã‚€ã ã‘
    db.collection("ownerNews")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        ownerNewsList.innerHTML = "";
        if (snap.empty) {
          ownerNewsEmpty.style.display = "block";
          return;
        }
        ownerNewsEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "card";

          const title = data.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)";
          const body = (data.body || "").replace(/\n/g, "<br>");
          const author = data.author || "ã‚ªãƒ¼ãƒŠãƒ¼";
          const dateText = formatDate(data.createdAt);

          div.innerHTML = `
            <div class="item-title">${title}</div>
            <div class="item-body">${body}</div>
            <div class="item-meta">
              <span>${author}</span>
              <span>${dateText}</span>
            </div>
          `;
          ownerNewsList.appendChild(div);
        });
      });


    // ============================
    // â‘¡ reportsï¼ˆã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…ï¼‰
    // ============================
    const reportForm = document.getElementById("reportForm");
    const reportsList = document.getElementById("reportsList");
    const reportsEmpty = document.getElementById("reportsEmpty");

    reportForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const category = document.getElementById("reportCategory").value;
      const message = document.getElementById("reportMessage").value.trim();
      const name = document.getElementById("reportName").value.trim() || "ï¼ˆåŒ¿åï¼‰";

      if (!message) {
        alert("å†…å®¹ã¯å¿…é ˆã§ã™ã€‚");
        return;
      }

      try {
        await db.collection("reports").add({
          category,
          message,
          staffName: name,
          status: "æœªå¯¾å¿œ",
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        reportForm.reset();
        alert("å ±å‘Šã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ã ã‘ãŒç¢ºèªã§ãã¾ã™ï¼‰");
      } catch (err) {
        console.error(err);
        alert("å ±å‘Šã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    });

    // ã‚ªãƒ¼ãƒŠãƒ¼ç”¨ï¼šä¸€è¦§è¡¨ç¤º
    db.collection("reports")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        reportsList.innerHTML = "";
        if (snap.empty) {
          reportsEmpty.style.display = "block";
          return;
        }
        reportsEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "card";
          const cat = data.category || "ãã®ä»–";

          div.innerHTML = `
            <div class="item-title">
              <span class="badge">ã‚«ãƒ†ã‚´ãƒª: ${cat}</span>
              <span class="badge badge-status">${data.status || "æœªå¯¾å¿œ"}</span>
            </div>
            <div class="item-body">${(data.message || "").replace(/\n/g, "<br>")}</div>
            <div class="item-meta">
              <span>é€ä¿¡è€…ï¼š${data.staffName || "ï¼ˆä¸æ˜ï¼‰"}</span>
              <span>${formatDate(data.createdAt)}</span>
            </div>
          `;
          reportsList.appendChild(div);
        });
      });

    // ============================
    // â‘¢ boardï¼ˆå…¨å“¡æ²ç¤ºæ¿ï¼‰
    // ============================
    const boardForm = document.getElementById("boardForm");
    const boardList = document.getElementById("boardList");
    const boardEmpty = document.getElementById("boardEmpty");

    boardForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const message = document.getElementById("boardMessage").value.trim();
      const author = document.getElementById("boardAuthor").value.trim() || "åç„¡ã—";

      if (!message) {
        alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å¿…é ˆã§ã™ã€‚");
        return;
      }

      try {
        await db.collection("board").add({
          message,
          author,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        boardForm.reset();
      } catch (err) {
        console.error(err);
        alert("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    });

    db.collection("board")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        boardList.innerHTML = "";
        if (snap.empty) {
          boardEmpty.style.display = "block";
          return;
        }
        boardEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "card";

          div.innerHTML = `
            <div class="item-body">${(data.message || "").replace(/\n/g, "<br>")}</div>
            <div class="item-meta">
              <span>${data.author || "åç„¡ã—"}</span>
              <span>${formatDate(data.createdAt)}</span>
            </div>
          `;
          boardList.appendChild(div);
        });
      });
  </script>
</body>
</html>
