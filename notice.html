<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f5f5f5;
    color: #111;
    line-height: 1.6;
    font-size: 13px;
  }

  .app {
    max-width: 1400px;
    margin: 0 auto;
    padding: 16px 0 40px;
  }

  /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
  .top-bar {
    position: sticky;
    top: 0;
    z-index: 4000;
    background: transparent;
  }

  .top-bar-inner {
    max-width: 1414px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 8px;
    background: #111;
    color: #fff;
    padding: 14px 16px 10px;
    border-radius: 0;
  }

  .top-bar h1 {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    padding: 0;
    line-height: 1;
    letter-spacing: 0.3px;
    text-transform: none;
    color: #fff;
  }

  .role-select {
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    margin-left: auto;
  }

  .role-select select {
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 12px;
    background: #ffffff;
    color: #111;
  }

  .menu-btn {
    border: none;
    background: transparent;
    padding: 4px;
    border-radius: 999px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #fff;
  }

  .menu-btn:hover {
    background: rgba(255,255,255,0.12);
  }

  .hamburger-icon {
    display: inline-flex;
    flex-direction: column;
    gap: 3px;
    padding: 4px 2px;
  }

  .hamburger-icon span {
    display: block;
    width: 18px;
    height: 2px;
    border-radius: 999px;
    background: #fff;
  }

  /* ====== ã‚¿ãƒ– ====== */
  .tab-nav {
    display: flex;
    gap: 6px;
    padding: 8px 12px 0;
    background: #f5f5f5;
    position: sticky;
    top: 42px;
    z-index: 9;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .tab-nav::-webkit-scrollbar {
    width: 0;
    height: 0;
    display: none;
  }

  .tab-btn {
    flex: 1 0 auto;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #dddddd;
    background: #ffffff;
    font-size: 11px;
    cursor: pointer;
    white-space: nowrap;
    color: #333;
  }

  .tab-btn.active {
    background: #111;
    color: #fff;
    border-color: #111;
    font-weight: 600;
  }

  .tab-panel {
    display: none;
    padding: 18px 12px 0;
  }

  .tab-panel.active {
    display: block;
  }

  .section-head {
    margin: 0 0 12px;
  }

  .section-head h2 {
    font-size: 13px;
    font-weight: 600;
    color: #111;
  }

  .section-head p {
    font-size: 11px;
    color: #666;
  }

  /* ====== ã‚«ãƒ¼ãƒ‰ ====== */
  .card {
    background: #ffffff;
    border-radius: 10px;
    padding: 10px 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    margin-bottom: 10px;
    border: 1px solid #dddddd;
  }

  .form-group {
    margin-bottom: 8px;
  }

  .form-group label {
    display: block;
    font-size: 11px;
    margin-bottom: 2px;
    color: #555;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #cccccc;
    font-size: 13px;
    resize: vertical;
    background: #ffffff;
    color: #111;
  }

  textarea {
    min-height: 60px;
  }

  .btn-row {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 6px;
  }

  .btn {
    padding: 6px 12px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 12px;
  }

  .btn-primary {
    background: #111;
    color: #fff;
  }

  .btn-ghost {
    background: #f0f0f0;
    color: #333;
  }

  .item-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 2px;
    color: #111;
  }

  .item-body {
    font-size: 13px;
    white-space: pre-wrap;
    margin-bottom: 4px;
    color: #333;
  }

  .item-meta {
    font-size: 11px;
    color: #777;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .badge {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 999px;
    font-size: 10px;
    background: #f5f0d6;
    color: #8a6d3b;
    border: 1px solid #f0e2b8;
  }

  .badge-status {
    background: #fbe5e5;
    color: #b00000;
    border-color: #f1c0c0;
  }

  .owner-only { display: none; }
  .staff-only { display: block; }

  body.role-owner .owner-only { display: block; }
  body.role-staff .staff-only { display: block; }

  .empty-text {
    font-size: 12px;
    color: #888;
    padding: 4px 2px 2px;
  }

  .tab-note {
    font-size: 12px;
    color: #666;
    line-height: 1.5;
  }

  /* å†™çœŸã¤ãã‚¿ã‚¹ã‚¯ç”¨ */
  .photo-thumb {
    display: block;
    width: 100%;
    max-width: 520px;
    aspect-ratio: 16 / 9;
    object-fit: contain;
    border-radius: 12px;
    margin: 8px auto;
    background: #000;
  }

  .photo-badge-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 4px;
  }

  /* ===== ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== */
  .side-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 4500;
    display: none;
  }

  .side-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 260px;
    height: 100%;
    background: #ffffff;
    color: #111;
    z-index: 4600;
    transform: translateX(-100%);
    transition: transform 0.2s ease-out;
    padding: 12px 0;
    box-shadow: 2px 0 8px rgba(0,0,0,0.2);
  }

  .side-menu-header {
    padding: 0 16px 8px;
    font-size: 13px;
    font-weight: 600;
    border-bottom: 1px solid #eeeeee;
    margin-bottom: 4px;
  }

  .side-menu ul {
    list-style: none;
  }

  .menu-item button,
  .menu-item a {
    width: 100%;
    border: none;
    background: transparent;
    color: inherit;
    text-align: left;
    padding: 10px 16px;
    font-size: 13px;
    cursor: pointer;
    display: block;
    text-decoration: none;
  }

  .menu-item button:hover,
  .menu-item a:hover {
    background: rgba(0,0,0,0.04);
  }

  body.menu-open .side-menu-overlay {
    display: block;
  }

  body.menu-open .side-menu {
    transform: translateX(0);
  }

  @media (max-width: 480px) {
    .top-bar h1 {
      font-size: 16px;
    }
  }

  /* ğŸ“Œ Noticeãƒšãƒ¼ã‚¸ã ã‘ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚’éè¡¨ç¤º */
  .menu-btn {
    display: none !important;
  }
  .mobile-menu-btn {
    display: none !important;
  }

  /* ğŸ“Œ Noticeãƒšãƒ¼ã‚¸ï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸­å¤®å¯„ã› */
  .notice-wrapper,
  #noticeList,
  #noticeTabs,
  #noticeHeader {
    margin-left: auto;
    margin-right: auto;
    max-width: 960px;
  }

  body {
    padding-left: 0 !important;
  }
  </style>
</head>

<body class="role-staff theme-dark">
  <div class="top-bar">
    <div class="top-bar-inner">
      <button class="menu-btn" id="menuBtn" type="button">
        <span class="hamburger-icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
      <h1>ãŠçŸ¥ã‚‰ã›ã‚»ãƒ³ã‚¿ãƒ¼</h1>
    </div>
  </div>

  <div class="app">
    <!-- ã‚¿ãƒ– -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="ownerNews">â‘  çµŒå–¶è€… â†’ å…¨å“¡</button>
      <button class="tab-btn" data-tab="reports">â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…</button>
      <button class="tab-btn" data-tab="board">â‘¢ å…¨å“¡æ²ç¤ºæ¿</button>
      <button class="tab-btn" data-tab="taskPhotos">â‘£ å†™çœŸã¤ãã‚¿ã‚¹ã‚¯å ±å‘Š</button>
    </div>

    <!-- â‘  çµŒå–¶è€… â†’ å…¨å“¡ -->
    <section class="tab-panel active" id="tab-ownerNews">
      <div class="section-head">
        <h2>â‘  çµŒå–¶è€… â†’ å…¨å“¡ã¸ã®ãŠçŸ¥ã‚‰ã›</h2>
        <p>ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰å…¨ã‚¹ã‚¿ãƒƒãƒ•ã«ä¼ãˆãŸã„ã“ã¨ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>
      </div>

      <div class="card">
        <p class="tab-note">
          â€»ã“ã“ã¯çµŒå–¶è€…ã‹ã‚‰ã®é€£çµ¡å°‚ç”¨ã§ã™ã€‚<br>
          æŠ•ç¨¿ãƒ»ç·¨é›†ã¯ <strong>ç®¡ç†ç”»é¢ï¼ˆowner.html ã®ã€ŒãŠçŸ¥ã‚‰ã›ç®¡ç†ã€ï¼‰</strong> ã‹ã‚‰ã®ã¿è¡Œãˆã¾ã™ã€‚
        </p>
      </div>

      <div id="ownerNewsList"></div>
      <div id="ownerNewsEmpty" class="empty-text">ã¾ã ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    </section>

    <!-- â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€… -->
    <section class="tab-panel" id="tab-reports">
      <div class="section-head">
        <h2>â‘¡ ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…ï¼ˆéå…¬é–‹ã®å ±å‘Šç®±ï¼‰</h2>
        <p>ã“ã“ã‹ã‚‰é€ã£ãŸå†…å®¹ã¯ã‚ªãƒ¼ãƒŠãƒ¼ã ã‘ãŒè¦‹ã‚Œã¾ã™ã€‚ä»–ã®ã‚¹ã‚¿ãƒƒãƒ•ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
      </div>

      <div class="card staff-only">
        <form id="reportForm">
          <div class="form-group">
            <label for="reportCategory">ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="reportCategory">
              <option value="è¨­å‚™">è¨­å‚™</option>
              <option value="ãŠå®¢æ§˜">ãŠå®¢æ§˜</option>
              <option value="ã‚·ãƒ•ãƒˆ">ã‚·ãƒ•ãƒˆ</option>
              <option value="æ¥­å‹™">æ¥­å‹™</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label for="reportMessage">å†…å®¹</label>
            <textarea id="reportMessage" placeholder="ä¾‹ï¼šå†·å‡åº«ã®æ¸©åº¦ãŒé«˜ã‚ã§ã™ / ç™ºæ³¨ãƒŸã‚¹ã—ã¦ã—ã¾ã„ã¾ã—ãŸ ãªã©"></textarea>
          </div>
          <div class="form-group">
            <label for="reportName">åå‰ã¾ãŸã¯ç«¯æœ«å</label>
            <input id="reportName" type="text" placeholder="ä¾‹ï¼šãŸãªã‹ / ãƒ¬ã‚¸æ¨ªã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ ãªã©" />
          </div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">å ±å‘Šã‚’é€ä¿¡ã™ã‚‹</button>
          </div>
        </form>
      </div>

      <div class="owner-only">
        <div id="reportsList"></div>
        <div id="reportsEmpty" class="empty-text">ã¾ã å ±å‘Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
      </div>
    </section>

    <!-- â‘¢ å…¨å“¡æ²ç¤ºæ¿ -->
    <section class="tab-panel" id="tab-board">
      <div class="section-head">
        <h2>â‘¢ å…¨å“¡æ²ç¤ºæ¿</h2>
        <p>ã¿ã‚“ãªã§å…±æœ‰ã—ãŸã„ã“ã¨ã‚’æ°—è»½ã«æ›¸ã‘ã‚‹æ²ç¤ºæ¿ã§ã™ã€‚ï¼ˆæ¥­å‹™ã«é–¢ä¿‚ã‚ã‚‹å†…å®¹ã§ï¼‰</p>
      </div>

      <div class="card">
        <form id="boardForm">
          <div class="form-group">
            <label for="boardMessage">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
            <textarea id="boardMessage" placeholder="ä¾‹ï¼šå†·å‡åº«ã®éœœãŒå¤šã„ã®ã§ã€æ¬¡ã®äººå°‘ã—æ™‚é–“ã‚ã‚Œã°ãŠé¡˜ã„ã—ã¾ã™ ãªã©"></textarea>
          </div>
          <div class="form-group">
            <label for="boardAuthor">åå‰ã¾ãŸã¯ç«¯æœ«å</label>
            <input id="boardAuthor" type="text" placeholder="ä¾‹ï¼šãªã‹ã«ã— / æ·±å¤œã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ ãªã©" />
          </div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">æ²ç¤ºæ¿ã«æŠ•ç¨¿ã™ã‚‹</button>
          </div>
        </form>
      </div>

      <div id="boardList"></div>
      <div id="boardEmpty" class="empty-text">ã¾ã æ²ç¤ºæ¿ã®æŠ•ç¨¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    </section>

    <!-- â‘£ å†™çœŸã¤ãã‚¿ã‚¹ã‚¯å ±å‘Š -->
    <section class="tab-panel" id="tab-taskPhotos">
      <div class="section-head">
        <h2>â‘£ å†™çœŸã¤ãã‚¿ã‚¹ã‚¯å ±å‘Šï¼ˆAã‚¿ã‚¹ã‚¯ç”¨ï¼‰</h2>
        <p>
          ã€ŒAã‚¿ã‚¹ã‚¯ï¼ˆå†™çœŸå¿…é ˆï¼‰ã€ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸã‚’ã“ã“ã«ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å½¢å¼ã§è¡¨ç¤ºã—ã¾ã™ã€‚<br>
          ã©ã®æ™‚é–“å¸¯ã§ãƒ»ã©ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒ»èª°ãŒå®Ÿæ–½ã—ãŸã‹ã‚’ã€å†™çœŸä»˜ãã§ç¢ºèªã§ãã¾ã™ã€‚
        </p>
      </div>

      <div id="photoList"></div>
      <div id="photoEmpty" class="empty-text">ã¾ã å†™çœŸã¤ãã‚¿ã‚¹ã‚¯ã®å ±å‘Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    </section>
  </div>

  <!-- ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="side-menu-overlay" id="sideOverlay"></div>
  <nav class="side-menu" id="sideMenu">
    <div class="side-menu-header">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul>
      <li class="menu-item">
        <button type="button" data-scroll="tab-taskPhotos">ğŸ“· å†™çœŸã¤ãã‚¿ã‚¹ã‚¯å ±å‘Šã¸</button>
      </li>
      <li class="menu-item">
        <button type="button" data-scroll="tab-ownerNews">ğŸ“¢ çµŒå–¶è€… â†’ å…¨å“¡ã¸</button>
      </li>
      <li class="menu-item">
        <button type="button" data-scroll="tab-board">ğŸ’¬ å…¨å“¡æ²ç¤ºæ¿ã¸</button>
      </li>
      <li class="menu-item">
        <button type="button" data-scroll="tab-reports">ğŸ“© ã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…ã¸</button>
      </li>
    </ul>
  </nav>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // =============================
    // Firebase è¨­å®š
    // =============================
    const firebaseConfig = {
      apiKey: "AIzaSyAPBMvTpzKCcPxLETncBqVR8fzf0cqKirc",
      authDomain: "lawson-workflow.firebaseapp.com",
      projectId: "lawson-workflow",
      storageBucket: "lawson-workflow.firebasestorage.app",
      messagingSenderId: "335371795694",
      appId: "1:335371795694:web:3b0950a616d368b284c7ff",
      measurementId: "G-BGENZNZMRC"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // =============================
    // åº—èˆ—IDã®å–å¾—ï¼ˆ?store=xxx å¿…é ˆï¼‰
    // =============================
    function getStoreId() {
      const params = new URLSearchParams(location.search);
      const s = params.get("store");
      if (s && s.trim()) {
        return s.trim();
      }
      alert("åº—èˆ—IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ï¼ˆnotice.html?store=åº—èˆ—ID ã®å½¢å¼ã§é–‹ã„ã¦ãã ã•ã„ï¼‰");
      throw new Error("STORE_ID not set");
    }

    // â˜… åº—èˆ—ID & storeRef
    const STORE_ID = getStoreId();
    const storeRef = db.collection("stores").doc(STORE_ID);

    // å½¹å‰²ï¼ˆã‚¹ã‚¿ãƒƒãƒ•å›ºå®šï¼‰
    document.body.classList.add("role-staff");

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;

        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        document.querySelectorAll(".tab-panel").forEach(panel => {
          panel.classList.toggle("active", panel.id === `tab-${tab}`);
        });
      });
    });

    // ===== æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ =====
    function formatDate(ts) {
      if (!ts) return "";
      const d = ts.toDate();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const hh = String(d.getHours()).padStart(2, "0");
      const mi = String(d.getMinutes()).padStart(2, "0");
      return `${yyyy}/${mm}/${dd} ${hh}:${mi}`;
    }

    // ============================
    // â‘  ownerNewsï¼ˆçµŒå–¶è€… â†’ å…¨å“¡ï¼‰
    // ============================
    const ownerNewsList = document.getElementById("ownerNewsList");
    const ownerNewsEmpty = document.getElementById("ownerNewsEmpty");

    storeRef
      .collection("ownerNews")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        ownerNewsList.innerHTML = "";
        if (snap.empty) {
          ownerNewsEmpty.style.display = "block";
          return;
        }
        ownerNewsEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data() || {};
          const div = document.createElement("div");
          div.className = "card";

          const title = data.title || "(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)";
          const body = (data.body || "").replace(/\n/g, "<br>");
          const author = data.author || "ã‚ªãƒ¼ãƒŠãƒ¼";
          const dateText = formatDate(data.createdAt);

          div.innerHTML = `
            <div class="item-title">${title}</div>
            <div class="item-body">${body}</div>
            <div class="item-meta">
              <span>${author}</span>
              <span>${dateText}</span>
            </div>
          `;
          ownerNewsList.appendChild(div);
        });
      });

    // ============================
    // â‘¡ reportsï¼ˆã‚¹ã‚¿ãƒƒãƒ• â†’ çµŒå–¶è€…ï¼‰
    // ============================
    const reportForm = document.getElementById("reportForm");
    const reportsList = document.getElementById("reportsList");
    const reportsEmpty = document.getElementById("reportsEmpty");

    reportForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const category = document.getElementById("reportCategory").value;
      const message = document.getElementById("reportMessage").value.trim();
      const name = document.getElementById("reportName").value.trim() || "ï¼ˆåŒ¿åï¼‰";

      if (!message) {
        alert("å†…å®¹ã¯å¿…é ˆã§ã™ã€‚");
        return;
      }

      try {
        await storeRef.collection("reports").add({
          category,
          message,
          staffName: name,
          status: "æœªå¯¾å¿œ",
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        reportForm.reset();
        alert("å ±å‘Šã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ã ã‘ãŒç¢ºèªã§ãã¾ã™ï¼‰");
      } catch (err) {
        console.error(err);
        alert("å ±å‘Šã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    });

    storeRef
      .collection("reports")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        if (!reportsList) return;
        reportsList.innerHTML = "";
        if (snap.empty) {
          reportsEmpty.style.display = "block";
          return;
        }
        reportsEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data() || {};
          const div = document.createElement("div");
          div.className = "card";
          const cat = data.category || "ãã®ä»–";

          div.innerHTML = `
            <div class="item-title">
              <span class="badge">ã‚«ãƒ†ã‚´ãƒª: ${cat}</span>
              <span class="badge badge-status">${data.status || "æœªå¯¾å¿œ"}</span>
            </div>
            <div class="item-body">${(data.message || "").replace(/\n/g, "<br>")}</div>
            <div class="item-meta">
              <span>é€ä¿¡è€…ï¼š${data.staffName || "ï¼ˆä¸æ˜ï¼‰"}</span>
              <span>${formatDate(data.createdAt)}</span>
            </div>
          `;
          reportsList.appendChild(div);
        });
      });

    // ============================
    // â‘¢ boardï¼ˆå…¨å“¡æ²ç¤ºæ¿ï¼‰
    // ============================
    const boardForm = document.getElementById("boardForm");
    const boardList = document.getElementById("boardList");
    const boardEmpty = document.getElementById("boardEmpty");

    const photoList  = document.getElementById("photoList");
    const photoEmpty = document.getElementById("photoEmpty");

    boardForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const message = document.getElementById("boardMessage").value.trim();
      const author = document.getElementById("boardAuthor").value.trim() || "åç„¡ã—";

      if (!message) {
        alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å¿…é ˆã§ã™ã€‚");
        return;
      }

      try {
        await storeRef.collection("board").add({
          message,
          author,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        boardForm.reset();
      } catch (err) {
        console.error(err);
        alert("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    });

    storeRef
      .collection("board")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap) => {
        boardList.innerHTML = "";
        if (snap.empty) {
          boardEmpty.style.display = "block";
          return;
        }
        boardEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data() || {};
          const div = document.createElement("div");
          div.className = "card";

          div.innerHTML = `
            <div class="item-body">${(data.message || "").replace(/\n/g, "<br>")}</div>
            <div class="item-meta">
              <span>${data.author || "åç„¡ã—"}</span>
              <span>${formatDate(data.createdAt)}</span>
            </div>
          `;
          boardList.appendChild(div);
        });
      });

    // ============================
    // â‘£ taskPhotosï¼ˆå†™çœŸã¤ãã‚¿ã‚¹ã‚¯å ±å‘Šï¼‰
    // ============================
    storeRef
      .collection("photoReports")  // â† ã“ã“ã¯ä»Šã®ã¾ã¾ã€‚å¾Œã§ taskPhotos ã«å¤‰ãˆãŸããªã£ãŸã‚‰è¨€ã£ã¦ï¼
      .orderBy("createdAt", "desc")
      .limit(100)
      .onSnapshot((snap) => {
        photoList.innerHTML = "";
        if (snap.empty) {
          photoEmpty.style.display = "block";
          return;
        }
        photoEmpty.style.display = "none";

        snap.forEach(doc => {
          const data = doc.data() || {};
          const div = document.createElement("div");
          div.className = "card";

          const imageUrl =
            data.photourl ||
            data.photoUrl ||
            data.photoURL ||
            data.url ||
            "";

          const taskLabel = data.taskLabel || "(ã‚¿ã‚¹ã‚¯åãªã—)";
          const slotLabel = data.slotId || "";
          const staffName = data.deviceLabel || "ï¼ˆç«¯æœ«å æœªè¨­å®šï¼‰";
          const bizDate   = data.businessKey || "";
          const dateText  = data.createdAt ? formatDate(data.createdAt) : "";

          div.innerHTML = `
            <div class="photo-badge-row">
              <span class="badge">Aã‚¿ã‚¹ã‚¯ï¼ˆå†™çœŸå¿…é ˆï¼‰</span>
              ${slotLabel ? `<span class="badge">${slotLabel}</span>` : ""}
              ${bizDate ? `<span class="badge">å–¶æ¥­æ—¥: ${bizDate}</span>` : ""}
            </div>
            ${imageUrl ? `<img src="${imageUrl}" alt="ã‚¿ã‚¹ã‚¯å†™çœŸ" class="photo-thumb">` : ""}
            <div class="item-title">${taskLabel}</div>
            <div class="item-meta">
              <span>æŠ•ç¨¿ï¼š${staffName}</span>
              ${dateText ? `<span>${dateText}</span>` : ""}
            </div>
          `;
          photoList.appendChild(div);
        });
      });

    // ============================
    // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰
    // ============================
    const menuBtn = document.getElementById("menuBtn");
    const sideMenu = document.getElementById("sideMenu");
    const sideOverlay = document.getElementById("sideOverlay");

    function openMenu() {
      document.body.classList.add("menu-open");
    }
    function closeMenu() {
      document.body.classList.remove("menu-open");
    }

    menuBtn?.addEventListener("click", openMenu);
    sideOverlay?.addEventListener("click", closeMenu);

    sideMenu?.addEventListener("click", (e) => {
      const target = e.target;
      if (target.matches("[data-scroll]")) {
        const panelId = target.getAttribute("data-scroll");
        const panel = document.getElementById(panelId);
        if (panel) {
          panel.scrollIntoView({ behavior: "smooth", block: "start" });
        }
        closeMenu();
      }
    });
  </script>
</body>
</html>
